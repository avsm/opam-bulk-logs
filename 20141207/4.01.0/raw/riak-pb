++ opam install riak-pb -e centos,centos-7
+ depext=
+ echo CentOS 7 depexts:
+ '[' '' '!=' '' ']'
+ opam install riak-pb
CentOS 7 depexts:
The following actions will be performed:
 - install   xmlm.1.2.0                            [required by piqi]
 - install   easy-format.1.0.2                     [required by piqi]
 - install   ulex.1.1                              [required by piqi]
 - install   piqi.0.6.5                            [required by riak-pb]
 - install   riak-pb.1.0.0
=== 5 to install ===

=-=- Synchronizing package archives -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[easy-format.1.0.2] Downloading http://mjambon.com/releases/easy-format/easy-format-1.0.2.tar.gz
[piqi.0.6.5] Downloading https://github.com/alavrik/piqi/archive/v0.6.5.tar.gz
[riak-pb.1.0.0] Downloading https://github.com/metadave/riak-ocaml-pb/archive/riak-pb-1.0.0.tar.gz
[ulex.1.1] Downloading http://ftp.de.debian.org/debian/pool/main/u/ulex/ulex_1.1.orig.tar.gz
[xmlm.1.2.0] Downloading http://erratique.ch/software/xmlm/releases/xmlm-1.2.0.tbz

=-=- Installing packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Building easy-format.1.0.2:
  make
  make install
Installing easy-format.1.0.2.
Building ulex.1.1:
  make
  make all.opt
  make install
Installing ulex.1.1.
Building xmlm.1.2.0:
  ./pkg/pkg-git
  ./pkg/build true
Installing xmlm.1.2.0.
Building piqi.0.6.5:
  ./configure --prefix /home/opam/.opam/4.01.0
  make
  make ocaml
  make install
  make ocaml-install
Installing piqi.0.6.5.
Building riak-pb.1.0.0:
  ./configure
  make
  make install
[ERROR] The compilation of riak-pb.1.0.0 failed.
Removing riak-pb.1.0.0.
  ocamlfind remove riak-pb


=-=- Error report -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
These actions have been completed successfully
 - install   piqi.0.6.5
 - install   ulex.1.1
 - install   easy-format.1.0.2
 - install   xmlm.1.2.0
The following failed
 - install   riak-pb.1.0.0

#=== ERROR while installing riak-pb.1.0.0 =====================================#
# opam-version         1.2.0
# os                   linux
# command              make
# path                 /home/opam/.opam/4.01.0/build/riak-pb.1.0.0
# compiler             4.01.0
# exit-code            2
# env-file             /home/opam/.opam/4.01.0/build/riak-pb.1.0.0/riak-pb-4215-c61e7b.env
# stdout-file          /home/opam/.opam/4.01.0/build/riak-pb.1.0.0/riak-pb-4215-c61e7b.out
# stderr-file          /home/opam/.opam/4.01.0/build/riak-pb.1.0.0/riak-pb-4215-c61e7b.err
### stdout ###
# ...[truncated]
# OCamlbuild additional flags: ......................... 
# Create documentations: ............................... true
# Compile tests executable and library and run them: ... false
# pkg_piqi: ............................................ /home/opam/.opam/4.01.0/lib/piqi
# pkg_piqi_runtime: .................................... /home/opam/.opam/4.01.0/lib/piqi
# 
# ocaml setup.ml -build 
# make[1]: Entering directory `/home/opam/.opam/4.01.0/build/riak-pb.1.0.0'
# piqi of-proto -I ./pb/ ./pb/riak.proto -o ./riak.proto.piqi
# make[1]: Leaving directory `/home/opam/.opam/4.01.0/build/riak-pb.1.0.0'
### stderr ###
# sh: protoc: command not found
# command execution failed: protoc -I./pb/ --include_imports --descriptor_set_out=./pb/riak.proto.pb ./pb/riak.proto
# make[1]: *** [piqi] Error 1
# E: Failure("Command 'make -f Makefile.piqi' terminated with error code 2")
# make: *** [build] Error 1


The former state can be restored with opam switch import "/home/opam/.opam/4.01.0/backup/state-20141107155232.export"
